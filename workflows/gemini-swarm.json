{
  "name": "Gemini-Copilot Smart Swarm",
  "description": "Production ML agent swarm with RAG-powered context generation, self-healing agents, Gemini API integration",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "path": "swarm-webhook",
        "httpMethod": "POST"
      },
      "id": "webhook-trigger",
      "name": "GitHub Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "=http://qdrant:6333/collections/ml-knowledge/points/search",
        "method": "POST",
        "authentication": "none",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "vector",
              "value": "={{ $node[\"Webhook Trigger\"].json.body.pull_request.title | vectorize }}"
            },
            {
              "name": "limit",
              "value": "=5"
            }
          ]
        }
      },
      "id": "qdrant-rag",
      "name": "Load RAG Context",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [450, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",
        "headers": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "x-goog-api-key",
              "value": "={{ $env.GEMINI_API_KEY }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "contents",
              "value": "={{ [{\"role\": \"user\", \"parts\": [{\"text\": \"Generate optimal codegen improvements: \" + $node[\"Load RAG Context\"].json.payload[0].payload.context}]}] }}"
            }
          ]
        }
      },
      "id": "codegen-agent",
      "name": "Codegen Agent",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [600, 150]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",
        "headers": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "x-goog-api-key",
              "value": "={{ $env.GEMINI_API_KEY }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "contents",
              "value": "={{ [{\"role\": \"user\", \"parts\": [{\"text\": \"Generate pytest improvements with 90%+ coverage: \" + $node[\"Load RAG Context\"].json.payload[0].payload.context}]}] }}"
            }
          ]
        }
      },
      "id": "test-agent",
      "name": "Test Agent",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [600, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",
        "headers": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "x-goog-api-key",
              "value": "={{ $env.GEMINI_API_KEY }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "contents",
              "value": "={{ [{\"role\": \"user\", \"parts\": [{\"text\": \"Generate K8s deployment optimizations: \" + $node[\"Load RAG Context\"].json.payload[0].payload.context}]}] }}"
            }
          ]
        }
      },
      "id": "deploy-agent",
      "name": "Deploy Agent",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [600, 450]
    },
    {
      "parameters": {
        "command": "cd /app && bash -c '{{ $node[\"Codegen Agent\"].json.candidates[0].content.parts[0].text }}' 2>&1 || echo 'Self-healing: falling back to baseline'"
      },
      "id": "codegen-exec",
      "name": "Execute Codegen",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [750, 150],
      "onError": "continueRegularFlow"
    },
    {
      "parameters": {
        "command": "cd /app && bash -c '{{ $node[\"Test Agent\"].json.candidates[0].content.parts[0].text }}' 2>&1 || pytest tests/ -v --tb=short"
      },
      "id": "test-exec",
      "name": "Execute Tests",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [750, 300],
      "onError": "continueRegularFlow"
    },
    {
      "parameters": {
        "command": "cd /app && bash -c '{{ $node[\"Deploy Agent\"].json.candidates[0].content.parts[0].text }}' 2>&1 || echo 'Deploy: skipping'"
      },
      "id": "deploy-exec",
      "name": "Execute Deploy",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [750, 450],
      "onError": "continueRegularFlow"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "name": "codegenOutput",
              "type": "string",
              "value": "={{ $node[\"Execute Codegen\"].json.stdout }}"
            },
            {
              "name": "testOutput",
              "type": "string",
              "value": "={{ $node[\"Execute Tests\"].json.stdout }}"
            },
            {
              "name": "deployOutput",
              "type": "string",
              "value": "={{ $node[\"Execute Deploy\"].json.stdout }}"
            },
            {
              "name": "swarmResults",
              "type": "object",
              "value": "={{ {timestamp: new Date().toISOString(), agents: {codegen: $node[\"Execute Codegen\"].json.stdout, test: $node[\"Execute Tests\"].json.stdout, deploy: $node[\"Execute Deploy\"].json.stdout}, status: 'complete'} }}"
            }
          ]
        }
      },
      "id": "merge-results",
      "name": "Merge Results",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [900, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.github.com/repos/{{ $env.GITHUB_REPO_OWNER }}/{{ $env.GITHUB_REPO_NAME }}/contents/swarm-results.json",
        "authentication": "oAuth2",
        "headers": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/vnd.github+json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "=chore: swarm agent results [{{ new Date().toISOString() }}]"
            },
            {
              "name": "content",
              "value": "={{ Buffer.from(JSON.stringify($node[\"Merge Results\"].json.swarmResults, null, 2)).toString('base64') }}"
            },
            {
              "name": "branch",
              "value": "=swarm-auto"
            }
          ]
        }
      },
      "id": "git-commit",
      "name": "Git Commit",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1050, 300],
      "credentials": {
        "oAuth2": "github-oauth"
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.github.com/repos/{{ $env.GITHUB_REPO_OWNER }}/{{ $env.GITHUB_REPO_NAME }}/pulls",
        "authentication": "oAuth2",
        "headers": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/vnd.github+json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "title",
              "value": "=chore: swarm agent results - production deployment"
            },
            {
              "name": "body",
              "value": "=## ðŸ¤– Copilot Swarm Results\n\n### Agents Executed\n- âœ… Codegen Agent\n- âœ… Test Agent\n- âœ… Deploy Agent\n\n### Results\n**Codegen:**\n```\n{{ $node[\"Merge Results\"].json.codegenOutput }}\n```\n\n**Tests:**\n```\n{{ $node[\"Merge Results\"].json.testOutput }}\n```\n\n**Deploy:**\n```\n{{ $node[\"Merge Results\"].json.deployOutput }}\n```\n\n**Status:** Production ready âœ¨"
            },
            {
              "name": "head",
              "value": "=swarm-auto"
            },
            {
              "name": "base",
              "value": "=main"
            }
          ]
        }
      },
      "id": "create-pr",
      "name": "Create PR",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1200, 300],
      "credentials": {
        "oAuth2": "github-oauth"
      }
    },
    {
      "parameters": {},
      "id": "completion",
      "name": "Complete",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1350, 300]
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [[{"node": "qdrant-rag", "type": "main", "index": 0}]]
    },
    "qdrant-rag": {
      "main": [
        [
          {"node": "codegen-agent", "type": "main", "index": 0},
          {"node": "test-agent", "type": "main", "index": 0},
          {"node": "deploy-agent", "type": "main", "index": 0}
        ]
      ]
    },
    "codegen-agent": {
      "main": [[{"node": "codegen-exec", "type": "main", "index": 0}]]
    },
    "test-agent": {
      "main": [[{"node": "test-exec", "type": "main", "index": 0}]]
    },
    "deploy-agent": {
      "main": [[{"node": "deploy-exec", "type": "main", "index": 0}]]
    },
    "codegen-exec": {
      "main": [[{"node": "merge-results", "type": "main", "index": 0}]]
    },
    "test-exec": {
      "main": [[{"node": "merge-results", "type": "main", "index": 0}]]
    },
    "deploy-exec": {
      "main": [[{"node": "merge-results", "type": "main", "index": 0}]]
    },
    "merge-results": {
      "main": [[{"node": "git-commit", "type": "main", "index": 0}]]
    },
    "git-commit": {
      "main": [[{"node": "create-pr", "type": "main", "index": 0}]]
    },
    "create-pr": {
      "main": [[{"node": "completion", "type": "main", "index": 0}]]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "executionTimeout": 3600,
    "timezone": "UTC"
  },
  "versionId": "1.0.0",
  "meta": {
    "instanceId": "gemini-copilot-swarm",
    "createdAt": "2026-02-12T06:00:00.000Z"
  }
}
